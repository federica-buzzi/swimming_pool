/*
Deployment script for swimming_pool_DB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "swimming_pool_DB"
:setvar DefaultFilePrefix "swimming_pool_DB"
:setvar DefaultDataPath "C:\Users\User\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\MSSQLLocalDB\"
:setvar DefaultLogPath "C:\Users\User\AppData\Local\Microsoft\Microsoft SQL Server Local DB\Instances\MSSQLLocalDB\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
/*
The column [dbo].[Admin].[Id] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[Admin])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The column [dbo].[BookingForm].[Id] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[BookingForm])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The column [dbo].[News].[Id] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[News])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The column [dbo].[Planning].[Id] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[Planning])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The column [dbo].[Prices].[Id] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[Prices])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
PRINT N'Starting rebuilding table [dbo].[Admin]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Admin] (
    [IdAdmin]       INT            IDENTITY (1, 1) NOT NULL,
    [AdminName]     NCHAR (10)     NOT NULL,
    [AdminPassword] VARBINARY (32) NOT NULL,
    [Salt]          CHAR (8)       NOT NULL,
    PRIMARY KEY CLUSTERED ([IdAdmin] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Admin])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Admin] ([AdminName], [AdminPassword], [Salt])
        SELECT [AdminName],
               [AdminPassword],
               [Salt]
        FROM   [dbo].[Admin];
    END

DROP TABLE [dbo].[Admin];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Admin]', N'Admin';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[BookingForm]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_BookingForm] (
    [IdBookingForm] INT            IDENTITY (1, 1) NOT NULL,
    [FirstName]     NVARCHAR (50)  NOT NULL,
    [LastName]      NVARCHAR (50)  NOT NULL,
    [SpotsBooked]   INT            NOT NULL,
    [Email]         NVARCHAR (323) NOT NULL,
    [Telephone]     NCHAR (12)     NOT NULL,
    [BookingDate]   DATE           NOT NULL,
    [Message]       NVARCHAR (MAX) NULL,
    [BookingTime]   NVARCHAR (50)  NOT NULL,
    PRIMARY KEY CLUSTERED ([IdBookingForm] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[BookingForm])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_BookingForm] ([FirstName], [LastName], [SpotsBooked], [Email], [Telephone], [BookingDate], [Message], [BookingTime])
        SELECT [FirstName],
               [LastName],
               [SpotsBooked],
               [Email],
               [Telephone],
               [BookingDate],
               [Message],
               [BookingTime]
        FROM   [dbo].[BookingForm];
    END

DROP TABLE [dbo].[BookingForm];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_BookingForm]', N'BookingForm';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[News]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_News] (
    [IdNews]  INT            IDENTITY (1, 1) NOT NULL,
    [Image]   NVARCHAR (MAX) NOT NULL,
    [Caption] NVARCHAR (MAX) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNews] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[News])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_News] ([Image], [Caption])
        SELECT [Image],
               [Caption]
        FROM   [dbo].[News];
    END

DROP TABLE [dbo].[News];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_News]', N'News';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Planning]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Planning] (
    [IdPlanning]         INT           IDENTITY (1, 1) NOT NULL,
    [ScheduledDays]      NVARCHAR (50) NOT NULL,
    [ScheduledTimeStart] NVARCHAR (50) NOT NULL,
    [ScheduledTimeEnd]   NVARCHAR (50) NOT NULL,
    [ExtraInfo]          NVARCHAR (50) NULL,
    PRIMARY KEY CLUSTERED ([IdPlanning] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Planning])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Planning] ([ScheduledDays], [ScheduledTimeStart], [ScheduledTimeEnd], [ExtraInfo])
        SELECT [ScheduledDays],
               [ScheduledTimeStart],
               [ScheduledTimeEnd],
               [ExtraInfo]
        FROM   [dbo].[Planning];
    END

DROP TABLE [dbo].[Planning];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Planning]', N'Planning';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Prices]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Prices] (
    [IdPrices]    INT           IDENTITY (1, 1) NOT NULL,
    [TicketType]  NVARCHAR (50) NOT NULL,
    [TicketPrice] FLOAT (53)    NOT NULL,
    [StGillois]   BIT           NOT NULL,
    PRIMARY KEY CLUSTERED ([IdPrices] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Prices])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Prices] ([TicketType], [TicketPrice], [StGillois])
        SELECT [TicketType],
               [TicketPrice],
               [StGillois]
        FROM   [dbo].[Prices];
    END

DROP TABLE [dbo].[Prices];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Prices]', N'Prices';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[SwimSession]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_SwimSession] (
    [IdSwimSession]           INT           IDENTITY (1, 1) NOT NULL,
    [SwimSessionDate]         NVARCHAR (50) NOT NULL,
    [SwimSessionTimeSlot]     NVARCHAR (50) NOT NULL,
    [SwimSessionNumberPeople] INT           NOT NULL,
    [SwimSessionMaxCapacity]  INT           NOT NULL,
    PRIMARY KEY CLUSTERED ([IdSwimSession] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[SwimSession])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_SwimSession] ON;
        INSERT INTO [dbo].[tmp_ms_xx_SwimSession] ([IdSwimSession], [SwimSessionDate], [SwimSessionTimeSlot], [SwimSessionNumberPeople], [SwimSessionMaxCapacity])
        SELECT   [IdSwimSession],
                 [SwimSessionDate],
                 [SwimSessionTimeSlot],
                 [SwimSessionNumberPeople],
                 [SwimSessionMaxCapacity]
        FROM     [dbo].[SwimSession]
        ORDER BY [IdSwimSession] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_SwimSession] OFF;
    END

DROP TABLE [dbo].[SwimSession];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_SwimSession]', N'SwimSession';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Booking]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Booking] (
    [IdBooking] INT            IDENTITY (1, 1) NOT NULL,
    [Message]   NVARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([IdBooking] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Booking])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Booking] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Booking] ([IdBooking], [Message])
        SELECT   [IdBooking],
                 [Message]
        FROM     [dbo].[Booking]
        ORDER BY [IdBooking] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Booking] OFF;
    END

DROP TABLE [dbo].[Booking];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Booking]', N'Booking';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[User]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_User] (
    [IdUser]    INT            IDENTITY (1, 1) NOT NULL,
    [FirstName] NVARCHAR (50)  NOT NULL,
    [LastName]  NVARCHAR (50)  NOT NULL,
    [Telephone] NCHAR (12)     NOT NULL,
    [Email]     NVARCHAR (323) NOT NULL,
    [isAdmin]   BIT            NULL,
    PRIMARY KEY CLUSTERED ([IdUser] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[User])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_User] ON;
        INSERT INTO [dbo].[tmp_ms_xx_User] ([IdUser], [FirstName], [LastName], [Telephone], [Email], [isAdmin])
        SELECT   [IdUser],
                 [FirstName],
                 [LastName],
                 [Telephone],
                 [Email],
                 [isAdmin]
        FROM     [dbo].[User]
        ORDER BY [IdUser] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_User] OFF;
    END

DROP TABLE [dbo].[User];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_User]', N'User';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Update complete.';


GO
